<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VBA 32→64-bit Converter</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <h1>VBA 32→64-bit Converter <span class="badge">client‑side</span></h1>
    <div class="row">
      <button class="btn ghost" id="btnLoadDemo" title="Load an example snippet">Load Demo</button>
      <input type="file" id="fileInput" accept=".bas,.cls,.txt" class="hidden" />
      <button class="btn ghost" id="btnOpen">Open .bas/.cls</button>
      <button class="btn" id="btnSave">Download Output</button>
      <button class="btn primary" id="btnConvert">Convert</button>
    </div>
  </header>

  <div class="env-banner">
    <div class="env" id="envStatus"><span class="dot"></span><strong>Environment guards active.</strong> This app is fully offline and does not use wallets or extensions. Any external‑provider errors will be captured and ignored.</div>
    <div class="env-list" id="envNotes"></div>
  </div>

  <div class="container">
    <section class="panel">
      <h2>Input (paste your 32‑bit VBA macro code)</h2>
      <textarea id="input" placeholder="Paste your VBA here…"></textarea>
      <div class="row">
        <label class="switch"><input type="checkbox" id="optAggressive" /> Aggressive pointer inference</label>
        <label class="switch"><input type="checkbox" id="optVars" /> Update variable declarations</label>
        <label class="switch"><input type="checkbox" id="optWrap" checked /> Wrap with #If VBA7 / #Else</label>
        <label class="switch"><input type="checkbox" id="optComments" checked /> Annotate changes with comments</label>
      </div>
      <div class="stats" id="statsIn">Ready.</div>
    </section>

    <section class="panel">
      <h2>Output (64‑bit compatible)</h2>
      <div class="row">
        <button class="btn" id="btnCopy">Copy to Clipboard</button>
        <span class="stats" id="stats"></span>
      </div>
      <textarea id="output" placeholder="Converted code will appear here…"></textarea>
      <div class="grid-3">
        <div>
          <div class="pill ok">Adds PtrSafe</div>
          <div class="small">Ensures every <span class="kbd">Declare</span> has <span class="kbd">PtrSafe</span>.</div>
        </div>
        <div>
          <div class="pill warn">Long → LongPtr (heuristic)</div>
          <div class="small">Only for pointer‑like names (e.g., <em>hWnd</em>, <em>lp*</em>, <em>*Ptr</em>, <em>*Handle</em>).</div>
        </div>
        <div>
          <div class="pill ok">Cross‑compatible</div>
          <div class="small">Optional wrapper keeps 32‑bit code for older Office.</div>
        </div>
      </div>
    </section>

    <section class="panel" style="grid-column: 1 / -1">
      <h2>Change Log</h2>
      <div class="log" id="log"></div>
    </section>

    <section class="panel" style="grid-column: 1 / -1">
      <h2>Unit Tests</h2>
      <div class="row">
        <button class="btn" id="btnRunTests">Run Tests</button>
        <span class="stats" id="testSummary"></span>
      </div>
      <div class="log" id="testLog"></div>
    </section>
  </div>

  <div class="footer">
    <strong>Notes:</strong> This tool uses safe, in‑browser text processing (no uploads). Heuristics can’t guarantee 100% correctness — always test in 64‑bit Office. For APIs returning pointers/handles, you may still need manual review.
  </div>

  <script src="app.js" defer></script>
</body>
</html>
